---
/**
 * Texas City Base Electricity Plans Route Handler
 * Handles URLs like /texas/dallas/electricity-plans (without additional filters)
 * Redirects to canonical /electricity-plans/dallas-tx/ format for SEO
 * 
 * This provides user-friendly URLs while maintaining canonical structure
 */

import { validateCitySlug, formatCitySlug } from '../../../config/tdsp-mapping';

// Enable server-side rendering for dynamic routes
export const prerender = false;

console.log('🚀 Texas City Base Plans Route: Processing request');

// Get dynamic parameters from URL
const { city } = Astro.params;

console.log(`📍 Texas base plans page requested: /texas/${city}/electricity-plans`);

// Validate city parameter
if (!city) {
  console.log('❌ No city provided, redirecting to main Texas page');
  return Astro.redirect('/texas/');
}

// Convert city name to slug format (e.g., "dallas" -> "dallas-tx")
const citySlug = formatCitySlug(city);

// Validate the city exists in our TDSP mapping
if (!validateCitySlug(citySlug)) {
  console.log(`❌ Invalid city: ${city}, redirecting to 404`);
  return Astro.redirect('/404');
}

// Build canonical URL for redirect
const canonicalUrl = `/electricity-plans/${citySlug}/`;

console.log(`↪️ Redirecting /texas/${city}/electricity-plans -> ${canonicalUrl}`);

// Redirect to canonical faceted navigation URL
return Astro.redirect(canonicalUrl, 301);
---