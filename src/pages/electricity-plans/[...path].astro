---
/**
 * Dynamic Faceted Navigation Route Handler with Static Generation Support
 * Handles all electricity-plans URLs with multiple filter combinations
 * Supports both static pre-generation and ISR for optimal performance
 * 
 * Pattern: /electricity-plans/[city-tx]/[filter1]/[filter2]/...
 * 
 * Examples:
 * - /electricity-plans/dallas-tx/
 * - /electricity-plans/dallas-tx/12-month/
 * - /electricity-plans/dallas-tx/12-month/fixed-rate/
 * - /electricity-plans/dallas-tx/green-energy/prepaid/
 */

import Layout from '../../layouts/Layout.astro';

// Enable server-side rendering for dynamic routes
export const prerender = false;

// Server-rendered dynamic route
console.log('ðŸš€ Faceted Navigation: Server-rendered dynamic route active');

// Get dynamic parameters from URL
const { path } = Astro.params;

// Simple validation - just parse the path segments
const pathSegments = path ? path.split('/').filter(Boolean) : [];
const citySlug = pathSegments[0] || 'dallas-tx';
const filterSegments = pathSegments.slice(1);

console.log(`ðŸ“ Faceted page requested: ${path}`);
console.log(`   City: ${citySlug}`);
console.log(`   Filters: ${filterSegments.join(', ')}`);

// Simple page title generation
const pageTitle = `Electricity Plans in ${citySlug.replace('-tx', '').replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}, Texas`;
const canonicalUrl = `/electricity-plans/${path || 'dallas-tx'}/`;

---

<Layout 
  title={pageTitle}
  description={`Compare electricity plans in ${citySlug.replace('-tx', '').replace('-', ' ')}, Texas`}
  canonical={canonicalUrl}
>
  <main class="min-h-screen bg-gray-50">
    <div class="bg-blue-600 text-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
        <div class="text-center">
          <h1 class="text-4xl md:text-6xl font-bold mb-6">
            {pageTitle}
          </h1>
          <p class="text-xl mb-4">
            URL Path: {path || 'dallas-tx'}
          </p>
          <p class="text-lg mb-4">
            City: {citySlug}
          </p>
          {filterSegments.length > 0 && (
            <p class="text-lg">
              Filters: {filterSegments.join(', ')}
            </p>
          )}
          
          <div class="mt-8 p-6 bg-white/10 rounded-lg">
            <h2 class="text-2xl font-bold mb-4">ðŸŽ‰ SUCCESS!</h2>
            <p class="text-lg">
              The faceted navigation routing system is now working correctly!
            </p>
            <p class="text-sm mt-2 opacity-75">
              This is a minimal test version. The full functionality will be restored next.
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">Test Links</h2>
        <div class="space-y-2">
          <a href="/electricity-plans/dallas-tx/" class="block text-blue-600 hover:text-blue-800">Dallas, TX - Basic</a>
          <a href="/electricity-plans/dallas-tx/12-month/" class="block text-blue-600 hover:text-blue-800">Dallas, TX - 12 Month</a>
          <a href="/electricity-plans/houston-tx/green-energy/" class="block text-blue-600 hover:text-blue-800">Houston, TX - Green Energy</a>
          <a href="/electricity-plans/austin-tx/fixed-rate/" class="block text-blue-600 hover:text-blue-800">Austin, TX - Fixed Rate</a>
          <a href="/electricity-plans/fort-worth-tx/prepaid/" class="block text-blue-600 hover:text-blue-800">Fort Worth, TX - Prepaid</a>
        </div>
      </div>
    </div>
  </main>
</Layout>

