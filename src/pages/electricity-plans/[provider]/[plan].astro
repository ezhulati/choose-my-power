---
import Layout from '../../../layouts/Layout.astro';
import { ProductDetailsPage } from '../../../components/ui/ProductDetailsPage';
import { Calendar, Zap, Shield, Leaf, Star, ArrowRight, CheckCircle, AlertCircle, Info } from 'lucide-react';

export async function getStaticPaths() {
  // This will be populated with actual plan data during build
  return [
    // Example paths - replace with actual data
    { params: { provider: 'reliant-energy', plan: 'secure-advantage-12' } },
    { params: { provider: 'txu-energy', plan: 'electric-freedom-24' } },
  ];
}

const { provider, plan } = Astro.params;

// Mock plan data - replace with actual API call
const planData = {
  id: 'secure-advantage-12',
  name: 'Secure Advantage 12',
  provider: {
    name: 'Reliant Energy',
    slug: 'reliant-energy',
    logo: '/images/providers/reliant.png',
    rating: 4.2,
    reviews: 28431,
    description: 'One of Texas\' largest electricity providers with 20+ years of experience.'
  },
  rate: 12.4,
  type: 'fixed',
  termLength: 12,
  renewablePercent: 35,
  fees: {
    monthlyFee: 9.95,
    cancellationFee: 175,
    connectionFee: 0,
    depositRequired: false
  },
  features: [
    'Fixed rate for entire contract',
    'Online account management',
    'Paperless billing discount',
    'Mobile app included',
    '24/7 customer support',
    'No deposit required'
  ],
  highlights: [
    'Most popular 12-month plan',
    'Price protection guarantee',
    'No surprise rate changes'
  ],
  availability: {
    cities: ['Dallas', 'Houston', 'Austin', 'San Antonio', 'Fort Worth'],
    zipCodes: ['75001', '75002', '77001', '78701'],
    tdsp: ['Oncor', 'CenterPoint Energy']
  }
};

const title = `${planData.name} by ${planData.provider.name} - Full Plan Details | ChooseMyPower`;
const description = `Complete details for ${planData.name}: ${planData.rate}¢/kWh fixed rate, ${planData.termLength}-month term. Compare features, read reviews, and sign up today.`;
---

<Layout title={title} description={description}>
  <div class="min-h-screen bg-gray-50">
    <!-- Breadcrumb Navigation -->
    <div class="bg-white border-b border-gray-200">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <nav class="text-sm text-gray-500">
          <a href="/" class="hover:text-texas-navy">Home</a>
          <span class="mx-2">/</span>
          <a href="/electricity-plans" class="hover:text-texas-navy">Electricity Plans</a>
          <span class="mx-2">/</span>
          <a href={`/providers/${planData.provider.slug}`} class="hover:text-texas-navy">{planData.provider.name}</a>
          <span class="mx-2">/</span>
          <span class="text-gray-900">{planData.name}</span>
        </nav>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid lg:grid-cols-3 gap-12">
        
        <!-- LEFT COLUMN - Plan Details -->
        <div class="lg:col-span-2 space-y-8">
          
          <!-- Plan Header -->
          <div class="bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
            <div class="flex items-start gap-6 mb-6">
              <img
                src={planData.provider.logo}
                alt={`${planData.provider.name} logo`}
                class="w-20 h-20 rounded-2xl object-cover border border-gray-200 shadow-sm"
              />
              <div class="flex-1">
                <h1 class="text-4xl font-bold text-gray-900 mb-3">{planData.name}</h1>
                <div class="flex items-center gap-4 mb-4">
                  <a href={`/providers/${planData.provider.slug}`} class="text-xl text-texas-navy hover:text-texas-red font-semibold">
                    {planData.provider.name}
                  </a>
                  <div class="flex items-center gap-2">
                    <div class="flex">
                      {[1,2,3,4,5].map(star => (
                        <Star key={star} class={`w-4 h-4 ${star <= Math.floor(planData.provider.rating) ? 'text-yellow-400 fill-current' : 'text-gray-300'}`} />
                      ))}
                    </div>
                    <span class="text-gray-600 text-sm">({planData.provider.reviews.toLocaleString()} reviews)</span>
                  </div>
                </div>
                
                <!-- Key Highlights -->
                <div class="flex flex-wrap gap-3">
                  {planData.highlights.map(highlight => (
                    <span key={highlight} class="px-4 py-2 bg-texas-gold-100 text-texas-navy font-semibold text-sm rounded-full">
                      {highlight}
                    </span>
                  ))}
                </div>
              </div>
            </div>
            
            <!-- Quick Stats Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
              <div class="text-center p-4 bg-texas-cream-50 rounded-xl border border-texas-cream-200">
                <div class="text-3xl font-bold text-texas-navy mb-1">{planData.rate}¢</div>
                <div class="text-gray-600 text-sm font-medium">per kWh</div>
              </div>
              <div class="text-center p-4 bg-blue-50 rounded-xl border border-blue-200">
                <div class="text-3xl font-bold text-blue-900 mb-1">{planData.termLength}</div>
                <div class="text-gray-600 text-sm font-medium">months</div>
              </div>
              <div class="text-center p-4 bg-green-50 rounded-xl border border-green-200">
                <div class="text-3xl font-bold text-green-900 mb-1">{planData.renewablePercent}%</div>
                <div class="text-gray-600 text-sm font-medium">renewable</div>
              </div>
              <div class="text-center p-4 bg-purple-50 rounded-xl border border-purple-200">
                <div class="text-3xl font-bold text-purple-900 mb-1">${planData.fees.monthlyFee}</div>
                <div class="text-gray-600 text-sm font-medium">monthly fee</div>
              </div>
            </div>
          </div>

          <!-- Tabbed Content -->
          <div class="bg-white rounded-2xl shadow-lg border border-gray-100">
            <!-- Tab Headers -->
            <div class="border-b border-gray-200">
              <div class="flex space-x-8 px-8 pt-6">
                <button class="pb-4 border-b-2 border-texas-navy text-texas-navy font-semibold tab-active">
                  Overview
                </button>
                <button class="pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-semibold">
                  Contract Details
                </button>
                <button class="pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-semibold">
                  Reviews
                </button>
                <button class="pb-4 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-semibold">
                  FAQ
                </button>
              </div>
            </div>
            
            <!-- Tab Content -->
            <div class="p-8">
              <!-- Overview Tab -->
              <div class="tab-content">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">What You Get</h3>
                
                <div class="grid md:grid-cols-2 gap-8">
                  <!-- Features -->
                  <div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">Plan Features</h4>
                    <div class="space-y-3">
                      {planData.features.map(feature => (
                        <div key={feature} class="flex items-center gap-3">
                          <CheckCircle class="w-5 h-5 text-green-500 flex-shrink-0" />
                          <span class="text-gray-700">{feature}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                  
                  <!-- Fees Breakdown -->
                  <div>
                    <h4 class="text-lg font-semibold text-gray-900 mb-4">All Fees</h4>
                    <div class="space-y-3">
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Monthly service fee</span>
                        <span class="font-semibold">${planData.fees.monthlyFee}</span>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Early termination fee</span>
                        <span class="font-semibold">${planData.fees.cancellationFee}</span>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Connection fee</span>
                        <span class="font-semibold text-green-600">
                          {planData.fees.connectionFee === 0 ? 'FREE' : `$${planData.fees.connectionFee}`}
                        </span>
                      </div>
                      <div class="flex justify-between items-center">
                        <span class="text-gray-700">Security deposit</span>
                        <span class="font-semibold text-green-600">
                          {planData.fees.depositRequired ? 'Required' : 'Not Required'}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                
                <!-- Availability -->
                <div class="mt-8 p-6 bg-gray-50 rounded-xl">
                  <h4 class="text-lg font-semibold text-gray-900 mb-4">Available In These Areas</h4>
                  <div class="grid md:grid-cols-2 gap-6">
                    <div>
                      <h5 class="font-medium text-gray-700 mb-2">Major Cities</h5>
                      <div class="flex flex-wrap gap-2">
                        {planData.availability.cities.map(city => (
                          <span key={city} class="px-3 py-1 bg-white text-gray-700 rounded-full text-sm border border-gray-200">
                            {city}
                          </span>
                        ))}
                      </div>
                    </div>
                    <div>
                      <h5 class="font-medium text-gray-700 mb-2">Utility Companies</h5>
                      <div class="flex flex-wrap gap-2">
                        {planData.availability.tdsp.map(tdsp => (
                          <span key={tdsp} class="px-3 py-1 bg-white text-gray-700 rounded-full text-sm border border-gray-200">
                            {tdsp}
                          </span>
                        ))}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Related Plans -->
          <div class="bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">Customers Also Viewed</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <!-- Mock related plans -->
              <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center gap-3 mb-3">
                  <img src="/images/providers/txu.png" alt="TXU" class="w-10 h-10 rounded-lg" />
                  <div>
                    <h4 class="font-semibold text-gray-900">Electric Freedom 24</h4>
                    <p class="text-sm text-gray-600">TXU Energy</p>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-2xl font-bold text-texas-navy">11.8¢</span>
                  <button class="bg-texas-navy text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-texas-red transition-colors">
                    View Details
                  </button>
                </div>
              </div>
              
              <div class="border border-gray-200 rounded-xl p-4 hover:shadow-md transition-shadow">
                <div class="flex items-center gap-3 mb-3">
                  <img src="/images/providers/direct.png" alt="Direct Energy" class="w-10 h-10 rounded-lg" />
                  <div>
                    <h4 class="font-semibold text-gray-900">Live Brighter 12</h4>
                    <p class="text-sm text-gray-600">Direct Energy</p>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-2xl font-bold text-texas-navy">13.2¢</span>
                  <button class="bg-texas-navy text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-texas-red transition-colors">
                    View Details
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT COLUMN - Selection Panel -->
        <div class="lg:col-span-1">
          <div class="sticky top-8 space-y-6">
            
            <!-- Pricing Calculator Card -->
            <div class="bg-white rounded-2xl shadow-lg p-8 border border-gray-100">
              <h3 class="text-2xl font-bold text-gray-900 mb-6">Your Monthly Cost</h3>
              
              <!-- Usage Slider -->
              <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Monthly Usage (kWh)
                </label>
                <input 
                  type="range" 
                  min="500" 
                  max="3000" 
                  value="1000" 
                  class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                  id="usageSlider"
                />
                <div class="flex justify-between text-sm text-gray-500 mt-1">
                  <span>500</span>
                  <span id="usageValue">1,000</span>
                  <span>3,000</span>
                </div>
              </div>
              
              <!-- Cost Breakdown -->
              <div class="bg-gray-50 rounded-xl p-4 mb-6">
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span>Electricity charges</span>
                    <span id="electricityCharge">$124.00</span>
                  </div>
                  <div class="flex justify-between">
                    <span>Monthly service fee</span>
                    <span>$9.95</span>
                  </div>
                  <div class="border-t border-gray-300 pt-2 flex justify-between font-semibold">
                    <span>Total monthly cost</span>
                    <span id="totalCost" class="text-texas-navy">$133.95</span>
                  </div>
                </div>
              </div>
              
              <!-- Primary CTA -->
              <button class="w-full bg-texas-red text-white py-4 px-6 rounded-xl font-bold text-lg hover:bg-texas-red-600 transition-all transform hover:scale-105 shadow-lg">
                Select This Plan
                <ArrowRight class="w-5 h-5 inline ml-2" />
              </button>
              
              <!-- Secondary Actions -->
              <div class="grid grid-cols-2 gap-3 mt-4">
                <button class="border-2 border-texas-navy text-texas-navy py-3 px-4 rounded-xl font-semibold hover:bg-texas-navy hover:text-white transition-all">
                  Compare Plans
                </button>
                <button class="border-2 border-gray-300 text-gray-700 py-3 px-4 rounded-xl font-semibold hover:bg-gray-50 transition-all">
                  Save for Later
                </button>
              </div>
            </div>

            <!-- Trust Signals -->
            <div class="bg-texas-cream-50 rounded-2xl p-6 border border-texas-cream-200">
              <div class="text-center">
                <Shield class="w-12 h-12 text-texas-gold mx-auto mb-3" />
                <h4 class="font-bold text-texas-navy mb-2">Protected Selection</h4>
                <p class="text-sm text-gray-600 mb-4">
                  Licensed provider • Rate guaranteed • No hidden fees
                </p>
                <div class="text-xs text-gray-500">
                  PUCT License #10039 • BBB Accredited
                </div>
              </div>
            </div>

            <!-- Help Section -->
            <div class="bg-blue-50 rounded-2xl p-6 border border-blue-200">
              <div class="text-center">
                <Info class="w-8 h-8 text-blue-600 mx-auto mb-3" />
                <h4 class="font-semibold text-blue-900 mb-2">Need Help Deciding?</h4>
                <p class="text-sm text-blue-700 mb-4">
                  Compare this plan with others or get personalized recommendations.
                </p>
                <button class="text-blue-600 font-semibold text-sm hover:text-blue-800">
                  Get Free Consultation →
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Interactive JavaScript -->
  <script>
    // Usage calculator
    const slider = document.getElementById('usageSlider');
    const usageValue = document.getElementById('usageValue');
    const electricityCharge = document.getElementById('electricityCharge');
    const totalCost = document.getElementById('totalCost');
    const rate = 12.4; // cents per kWh
    const monthlyFee = 9.95;

    function updateCost() {
      const usage = parseInt(slider.value);
      usageValue.textContent = usage.toLocaleString();
      
      const electricity = (usage * rate / 100);
      const total = electricity + monthlyFee;
      
      electricityCharge.textContent = `$${electricity.toFixed(2)}`;
      totalCost.textContent = `$${total.toFixed(2)}`;
    }

    slider.addEventListener('input', updateCost);
    
    // Tab switching
    const tabs = document.querySelectorAll('button[class*="tab"]');
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Remove active classes
        tabs.forEach(t => {
          t.classList.remove('border-texas-navy', 'text-texas-navy');
          t.classList.add('border-transparent', 'text-gray-500');
        });
        
        // Add active to clicked tab
        tab.classList.remove('border-transparent', 'text-gray-500');
        tab.classList.add('border-texas-navy', 'text-texas-navy');
      });
    });
  </script>
</Layout>