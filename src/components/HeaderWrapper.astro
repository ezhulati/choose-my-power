---
// HeaderWrapper.astro - Fixed Header with proper navigation visibility
---

<div id="header-container">
  <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-[100]" style="backdrop-filter: blur(8px); background-color: rgba(255, 255, 255, 0.95);">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo -->
        <div class="flex items-center">
          <a href="/" class="flex items-center space-x-2 text-blue-600 hover:text-blue-700 transition-colors">
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <span class="text-xl font-bold text-blue-800">ChooseMyPower</span>
          </a>
        </div>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex space-x-1">
          <a href="/compare" class="text-gray-700 hover:text-blue-600 px-4 py-2 text-sm font-medium transition-colors rounded-md hover:bg-blue-50">Compare</a>

          <div class="relative group">
            <button class="flex items-center space-x-1 text-gray-700 hover:text-blue-600 px-4 py-2 text-sm font-medium transition-colors rounded-md hover:bg-blue-50">
              <span>Browse</span>
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="absolute top-full left-0 w-56 bg-white border border-gray-200 rounded-md shadow-lg py-1 z-[120] opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
              <a href="/electricity-companies" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">Electricity Companies</a>
              <a href="/providers" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">All Providers</a>
              <a href="/texas" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">Texas Plans</a>
            </div>
          </div>

          <div class="relative group">
            <button class="flex items-center space-x-1 text-gray-700 hover:text-blue-600 px-4 py-2 text-sm font-medium transition-colors rounded-md hover:bg-blue-50">
              <span>Rates</span>
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <div class="absolute top-full left-0 w-56 bg-white border border-gray-200 rounded-md shadow-lg py-1 z-[120] opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
              <a href="/rates" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">Current Rates</a>
              <a href="/rates/calculator" class="block px-4 py-2 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">Rate Calculator</a>
            </div>
          </div>

          <a href="/shop" class="text-gray-700 hover:text-blue-600 px-4 py-2 text-sm font-medium transition-colors rounded-md hover:bg-blue-50">Shop</a>
          <a href="/locations" class="text-gray-700 hover:text-blue-600 px-4 py-2 text-sm font-medium transition-colors rounded-md hover:bg-blue-50">Locations</a>
          <a href="/resources" class="text-gray-700 hover:text-blue-600 px-4 py-2 text-sm font-medium transition-colors rounded-md hover:bg-blue-50">Resources</a>
        </nav>

        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button id="mobile-menu-button" class="text-gray-700 hover:text-blue-600 p-2">
            <svg id="menu-icon" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
            <svg id="close-icon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <div id="mobile-menu" class="hidden md:hidden border-t border-gray-200 py-4 bg-white z-[420]">
        <div class="space-y-1">
          <details class="group">
            <summary class="flex items-center justify-between w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors cursor-pointer">
              <span>Compare</span>
              <svg class="h-4 w-4 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="ml-4 space-y-1 mt-1">
              <a href="/compare/providers" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Compare Providers</a>
              <a href="/compare/plans" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Compare Plans</a>
              <a href="/compare/rates" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Compare Rates</a>
              <a href="/compare/providers/top-5" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Top 5 Providers</a>
            </div>
          </details>

          <details class="group">
            <summary class="flex items-center justify-between w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors cursor-pointer">
              <span>Browse</span>
              <svg class="h-4 w-4 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="ml-4 space-y-1 mt-1">
              <a href="/electricity-companies" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Electricity Companies</a>
              <a href="/electricity-plans" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Electricity Plans</a>
              <a href="/best" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Best Rankings</a>
              <a href="/providers" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">All Providers</a>
            </div>
          </details>

          <a href="/rates" class="block px-3 py-2 text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Rates</a>

          <details class="group">
            <summary class="flex items-center justify-between w-full text-left px-3 py-2 text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors cursor-pointer">
              <span>Shop</span>
              <svg class="h-4 w-4 transition-transform group-open:rotate-180" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </summary>
            <div class="ml-4 space-y-1 mt-1">
              <a href="/shop/cheapest-electricity" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Cheapest Electricity</a>
              <a href="/shop/best-electricity-providers" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Best Providers</a>
              <a href="/shop/green-energy" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Green Energy</a>
              <a href="/shop/no-deposit-electricity" class="block px-3 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">No Deposit Plans</a>
            </div>
          </details>

          <a href="/locations" class="block px-3 py-2 text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Locations</a>
          <a href="/resources" class="block px-3 py-2 text-base font-medium text-gray-700 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors">Resources</a>
        </div>
      </div>
    </div>
  </header>
</div>

<script>
  // Mobile menu toggle
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');

    if (mobileMenuButton && mobileMenu && menuIcon && closeIcon) {
      mobileMenuButton.addEventListener('click', function() {
        const isOpen = !mobileMenu.classList.contains('hidden');
        
        if (isOpen) {
          mobileMenu.classList.add('hidden');
          menuIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
        } else {
          mobileMenu.classList.remove('hidden');
          menuIcon.classList.add('hidden');
          closeIcon.classList.remove('hidden');
        }
      });
    }
  });
</script>

<style>
/* Fix critical navigation visibility issues using design system z-index values */
#header-container {
  position: relative;
  width: 100%;
}

/* Ensure header uses proper z-index from design system */
#header-container header {
  z-index: 100; /* Z_INDEX.HEADER */
  background-color: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid #e5e7eb;
}

/* Fix dropdown z-index issues - ensure they appear above hero content */
#header-container .group > div[class*="absolute"],
#header-container [role="menu"],
#header-container [data-radix-popper-content-wrapper],
#header-container .dropdown-menu {
  z-index: 1000 !important; /* High z-index to ensure visibility above all content */
  position: relative; /* Ensure proper stacking context */
}

/* Mobile menu fixes */
#header-container #mobile-menu {
  z-index: 420 !important; /* Z_INDEX.MOBILE_SIDE_MENU */
  background-color: white;
}

/* Ensure all navigation dropdowns appear above any background content */
#header-container nav .group:hover > div,
#header-container nav .group:focus-within > div {
  z-index: 1000 !important; /* High z-index to ensure visibility above all content */
  position: absolute; /* Ensure proper positioning for dropdowns */
}

/* Additional dropdown targeting for maximum coverage */
#header-container .group .absolute,
#header-container .group-hover\\:visible,
#header-container .group-hover\\:opacity-100 {
  z-index: 1000 !important;
  position: absolute !important;
}
</style>